<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= mode==='create' ? 'New' : 'Edit' %> Page - FNPulse Admin
    </title>
    <link rel="stylesheet" href="/public/css/admin.css">
</head>

<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>FNPulse</h2>
                <p>Admin Dashboard</p>
            </div>
            <nav class="sidebar-nav">
                <a href="/" class="nav-item">
                    <span class="icon">ğŸ“Š</span>
                    <span>Dashboard</span>
                </a>
                <a href="/articles" class="nav-item">
                    <span class="icon">ğŸ“</span>
                    <span>Articles</span>
                </a>
                <a href="/pages" class="nav-item active">
                    <span class="icon">ğŸ“„</span>
                    <span>Pages</span>
                </a>
                <a href="/authors" class="nav-item">
                    <span class="icon">ğŸ‘¤</span>
                    <span>Authors</span>
                </a>
                <a href="/ads" class="nav-item">
                    <span class="icon">ğŸ“¢</span>
                    <span>Ad Banners</span>
                </a>
                <a href="/images" class="nav-item">
                    <span class="icon">ğŸ–¼ï¸</span>
                    <span>Images</span>
                </a>
                <a href="/settings" class="nav-item">
                    <span class="icon">âš™ï¸</span>
                    <span>Settings</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="/site-assets/index.html" target="_blank" class="btn-preview">
                    <span class="icon">ğŸ‘ï¸</span>
                    Preview Site
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div>
                    <a href="/pages" class="back-link">â† Back to Pages</a>
                    <h1>
                        <%= mode==='create' ? 'Create New' : 'Edit' %> Page
                    </h1>
                </div>
                <div class="header-actions">
                    <button type="button" onclick="savePage()" class="btn btn-primary">Save Page</button>
                </div>
            </header>

            <form id="pageForm" class="article-form">
                <div class="form-section">
                    <h3>Page Details</h3>

                    <div class="form-group">
                        <label for="filename">Filename *</label>
                        <input type="text" id="filename" name="filename" class="form-control" placeholder="about.html"
                            value="<%= pageData && pageData.filename ? pageData.filename : '' %>" <%=mode==='edit'
                            ? 'readonly' : '' %> required>
                        <small>Use lowercase and end with .html</small>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Page HTML</h3>
                    <textarea id="html" name="html" class="form-control" rows="18"
                        style="font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;"><%- pageData && pageData.html ? pageData.html : '' %></textarea>
                </div>
            </form>
        </main>
    </div>

    <script src="/public/js/admin.js"></script>
    <script>
        async function savePage() {
            const form = document.getElementById('pageForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => data[key] = value);

            if (!data.filename) {
                alert('Please provide a filename.');
                return;
            }

            const mode = '<%= mode %>';
            const url = mode === 'create' ? '/api/pages' : `/api/pages/${data.filename}`;
            const method = mode === 'create' ? 'POST' : 'PUT';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    alert('âœ… Page saved successfully!');
                    window.location.href = '/pages';
                } else {
                    alert('âŒ Error: ' + result.error);
                }
            } catch (error) {
                alert('âŒ Error: ' + error.message);
            }
        }
    </script>
</body>

</html>