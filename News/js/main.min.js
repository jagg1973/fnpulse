(()=>{const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentNode;if(!t)return NodeFilter.FILTER_REJECT;const a=t.nodeName.toLowerCase();return"script"===a||"style"===a?NodeFilter.FILTER_REJECT:e.nodeValue&&e.nodeValue.includes("&amp;")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),t=[];for(;e.nextNode();)t.push(e.currentNode);t.forEach(e=>{e.nodeValue=e.nodeValue.replace(/&amp;/g,"&")});const a=document.querySelector(".mobile-toggle"),n=document.querySelector(".nav-links");a&&n&&(a.addEventListener("click",e=>{e.stopPropagation();const t=n.classList.toggle("is-open");a.setAttribute("aria-expanded",String(t))}),document.addEventListener("click",e=>{!n.classList.contains("is-open")||n.contains(e.target)||a.contains(e.target)||(n.classList.remove("is-open"),a.setAttribute("aria-expanded","false"))}),n.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{n.classList.remove("is-open"),a.setAttribute("aria-expanded","false")})}));document.body.insertAdjacentHTML("beforeend",'\n        <div id="video-modal" class="video-modal">\n            <div class="modal-backdrop"></div>\n            <div class="modal-content">\n                <button class="modal-close" aria-label="Close video">×</button>\n                <div class="video-wrapper">\n                    \x3c!-- Placeholder iframe --\x3e\n                    <iframe id="video-frame" src="" title="Video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>\n                </div>\n            </div>\n        </div>\n    ');const o=document.getElementById("video-modal"),i=o.querySelector("#video-frame"),s=o.querySelector(".modal-close"),r=o.querySelector(".modal-backdrop");function c(){i.src="https://www.youtube.com/embed/SltxJ3n8UQA?autoplay=1&mute=0&rel=0",o.classList.add("active"),document.body.style.overflow="hidden"}function l(){o.classList.remove("active"),setTimeout(()=>{i.src=""},300),document.body.style.overflow=""}const d=document.querySelector(".play-btn-large");d&&d.addEventListener("click",e=>{e.preventDefault(),c()});document.querySelectorAll(".video-item-small").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),c()})}),s.addEventListener("click",l),r.addEventListener("click",l),document.addEventListener("keydown",e=>{"Escape"===e.key&&o.classList.contains("active")&&l()});const u=document.querySelector("[data-live-ticker]"),m=document.querySelector("[data-market-list]"),p=document.querySelectorAll("[data-market-tab]"),g=document.querySelector("[data-market-source]"),h=document.querySelector("[data-events-list]"),v=window.location.origin&&"null"!==window.location.origin?window.location.origin:"http://localhost:3000",y=e=>`${v}${e}`,f={forex:"FX rates: open.er-api.com",crypto:"Crypto prices: coingecko.com",indices:"Indices: Yahoo Finance / Stooq",commodities:"Commodities: Yahoo Finance / Stooq"},w=new Map,b=(e,t=2)=>new Intl.NumberFormat("en-US",{minimumFractionDigits:t,maximumFractionDigits:t}).format(e),C=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),k=e=>{if(null==e||Number.isNaN(e))return"—";return`${e>0?"+":""}${b(e,2)}%`},L=async(e,t=1e4)=>{const a=new AbortController,n=setTimeout(()=>a.abort(),t);try{const t=await fetch(e,{signal:a.signal});if(!t.ok)throw new Error(`Request failed: ${t.status}`);return t}finally{clearTimeout(n)}},S=e=>`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`,x=async(e,t,a={})=>{try{const t=await L(e,a.timeout||8e3);if(t.ok)return{response:t,source:"local"}}catch(e){}return{response:await L(t,a.timeout||1e4),source:"remote"}},T=async e=>{if(m){m.innerHTML='<li class="market-loading">Loading market data…</li>';try{let t=[];"forex"===e&&(t=await(async()=>{if(w.has("forex"))return w.get("forex");const{response:e,source:t}=await x(y("/api/markets/forex"),"https://open.er-api.com/v6/latest/USD"),a=await e.json();if("local"===t&&a.items)return w.set("forex",a.items),a.items;if(!a||"success"!==a.result)throw new Error("Forex data unavailable");const n=a.rates.EUR,o=a.rates.JPY,i=a.rates.GBP,s=[{label:"EUR/USD",value:b(1/n,4),changeText:"—",changeClass:"neutral"},{label:"USD/JPY",value:b(o,2),changeText:"—",changeClass:"neutral"},{label:"GBP/USD",value:b(1/i,4),changeText:"—",changeClass:"neutral"}];return w.set("forex",s),s})()),"crypto"===e&&(t=await(async()=>{if(w.has("crypto"))return w.get("crypto");const{response:e,source:t}=await x(y("/api/markets/crypto"),"https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd&include_24hr_change=true"),a=await e.json();if("local"===t&&a.items)return w.set("crypto",a.items),a.items;const n=[{label:"Bitcoin",value:`$${C(a.bitcoin.usd)}`,changeText:k(a.bitcoin.usd_24h_change),changeClass:a.bitcoin.usd_24h_change>=0?"up":"down"},{label:"Ethereum",value:`$${C(a.ethereum.usd)}`,changeText:k(a.ethereum.usd_24h_change),changeClass:a.ethereum.usd_24h_change>=0?"up":"down"},{label:"Solana",value:`$${C(a.solana.usd)}`,changeText:k(a.solana.usd_24h_change),changeClass:a.solana.usd_24h_change>=0?"up":"down"}];return w.set("crypto",n),n})()),"indices"===e&&(t=await(async()=>{if(w.has("indices"))return w.get("indices");const e=`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${encodeURIComponent(["^GSPC","^DJI","^IXIC"].join(","))}`,{response:t,source:a}=await x(y("/api/markets/indices"),S(e)),n=await t.json();if("local"===a&&n.items)return w.set("indices",n.items),n.items;const o={"^GSPC":"S&P 500","^DJI":"Dow Jones","^IXIC":"Nasdaq"},i=(n?.quoteResponse?.result||[]).map(e=>({label:o[e.symbol]||e.symbol,value:C(e.regularMarketPrice),changeText:k(e.regularMarketChangePercent),changeClass:e.regularMarketChangePercent>=0?"up":"down"}));return w.set("indices",i),i})()),"commodities"===e&&(t=await(async()=>{if(w.has("commodities"))return w.get("commodities");const e=`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${encodeURIComponent(["GC=F","SI=F","CL=F","BZ=F"].join(","))}`,{response:t,source:a}=await x(y("/api/markets/commodities"),S(e)),n=await t.json();if("local"===a&&n.items)return w.set("commodities",n.items),n.items;const o={"GC=F":"Gold","SI=F":"Silver","CL=F":"WTI Crude","BZ=F":"Brent Crude"},i=(n?.quoteResponse?.result||[]).map(e=>({label:o[e.symbol]||e.symbol,value:C(e.regularMarketPrice),changeText:k(e.regularMarketChangePercent),changeClass:e.regularMarketChangePercent>=0?"up":"down"}));return w.set("commodities",i),i})()),(e=>{m&&(m.innerHTML=e.map(e=>{const t=e.changeClass||"neutral",a=e.changeText||"—";return`\n                <li>\n                    <span>${e.label}</span>\n                    <strong>${e.value}</strong>\n                    <span class="${t}">${a}</span>\n                </li>\n            `}).join(""))})(t),g&&(g.textContent=`Live data sources: ${f[e]}.`)}catch(e){m.innerHTML='<li class="market-loading">Unable to load market data right now.</li>',g&&(g.textContent="Live data temporarily unavailable.")}}},E=async()=>{if(u)try{const e="https://www.marketwatch.com/rss/topstories",{response:t,source:a}=await x(y("/api/live-ticker"),S(e));if("local"===a){const e=await t.json();if(Array.isArray(e.headlines)&&e.headlines.length)return void(u.textContent=e.headlines.join(" • "))}const n=await t.text(),o=(new DOMParser).parseFromString(n,"text/xml"),i=Array.from(o.querySelectorAll("item > title")).map(e=>e.textContent.trim()).filter(Boolean).slice(0,6);i.length&&(u.textContent=i.join(" • "))}catch(e){0===u.textContent.trim().length&&(u.textContent="Live headlines unavailable at the moment.")}},F=async()=>{if(h)try{const e="https://api.tradingeconomics.com/calendar/country/united%20states?c=guest:guest&f=json",{response:t,source:a}=await x(y("/api/events"),S(e)),n=await t.json();if("local"===a&&Array.isArray(n.events))return n.events.length?void(h.innerHTML=n.events.map(e=>`\n                        <li>\n                            <span>${new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"2-digit"})}</span>\n                            <div>\n                                <strong>${e.event}</strong>\n                                <small>${e.detail}</small>\n                            </div>\n                        </li>\n                    `).join("")):void(h.innerHTML='<li class="events-loading">No upcoming events in the feed.</li>');const o=new Date,i=n.map(e=>({date:new Date(e.Date||e.date||e.datetime),event:e.Event||e.EventDescription||e.Title||"Market Event",detail:e.Forecast||e.Actual||e.Previous||e.Consensus||"Details pending"})).filter(e=>!Number.isNaN(e.date.getTime())&&e.date>=o).sort((e,t)=>e.date-t.date).slice(0,4);if(!i.length)return void(h.innerHTML='<li class="events-loading">No upcoming events in the feed.</li>');h.innerHTML=i.map(e=>`\n                    <li>\n                        <span>${e.date.toLocaleDateString("en-US",{month:"short",day:"2-digit"})}</span>\n                        <div>\n                            <strong>${e.event}</strong>\n                            <small>${e.detail}</small>\n                        </div>\n                    </li>\n                `).join("")}catch(e){h.innerHTML='<li class="events-loading">Unable to load events right now.</li>'}};p.length&&(p.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.marketTab;t&&((e=>{p.forEach(t=>{const a=t.dataset.marketTab===e;t.classList.toggle("is-active",a),t.setAttribute("aria-selected",String(a))})})(t),T(t))})}),T("forex")),E(),F(),setInterval(E,3e5),setInterval(F,9e5)})();